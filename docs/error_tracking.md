# توثيق الأخطاء وإصلاحها

## مقدمة

يهدف هذا الملف إلى توثيق الأخطاء التي تمت مواجهتها أثناء تطوير نظام أرشيف الصيانة وكيفية إصلاحها، وذلك لتسهيل عملية التطوير وتجنب تكرار نفس المشكلات في المستقبل.

تاريخ آخر تحديث: 04/04/2025

## تتبع الأخطاء

| رقم | التاريخ | الفئة | الوصف | الحل | الحالة |
|-----|---------|------|-------|-----|--------|
| 001 | 04/04/2025 | إعداد البنية الأساسية | أخطاء في تحديث ملفات `__init__.py` باستخدام أدوات التحرير التلقائية | تحديث الملفات يدويًا وتجنب استخدام أدوات التحرير لملفات `__init__.py` القصيرة جدًا | مغلق |

## تفاصيل الأخطاء

### 001: أخطاء في تحديث ملفات `__init__.py`

**الفئة**: إعداد البنية الأساسية

**الوصف**:
عند محاولة تحديث ملفات `__init__.py` في أدلة `endpoints` لإضافة استيراد الراوتر، واجهنا مشكلات تقنية مع أدوات التحرير التلقائية.

**تأثير المشكلة**:
تعطيل عملية الاستيراد التلقائي للراوتر في ملفات API، مما يمنع تسجيل نقاط النهاية بشكل صحيح.

**الحل**:
1. تم تحديث الملفات يدويًا بدلاً من الاعتماد على أدوات التحرير التلقائية.
2. تم إضافة سطر استيراد الراوتر في ملف `__init__.py` في كل مجلد endpoints مثل:
   ```python
   from app.api.v1.endpoints.auth.router import router
   ```

**الدروس المستفادة**:
- من الأفضل إنشاء ملفات `__init__.py` الصغيرة يدويًا بدلاً من الاعتماد على الأدوات التلقائية.
- يجب التخطيط لوضع القواعد الخاصة بتنظيم الاستيرادات مسبقًا لتجنب هذا النوع من المشكلات.

## مشكلات متكررة وحلولها

### 1. مشكلات ترتيب الاستيرادات الدائرية

**المشكلة**:
قد تحدث استيرادات دائرية عند استخدام نمط تنظيم الحزم الخاص بنا، خاصة بين الراوترات والمخططات والنماذج.

**الحل**:
- استخدام استيرادات النوع داخل الوظائف وليس على مستوى الوحدة.
- استخدام استيرادات مؤجلة عند الضرورة.
- تنظيم البنية بشكل منطقي لتجنب التبعيات الدائرية.

### 2. مشكلات أداء استعلامات قاعدة البيانات

**المشكلة**:
استعلامات قاعدة البيانات غير المحسنة قد تسبب بطء في الأداء، خاصة مع نمو البيانات.

**الحل**:
- استخدام `select_related` و`prefetch_related` لتحميل العلاقات بكفاءة.
- إضافة فهارس للحقول المستخدمة في البحث والتصفية.
- تحليل الاستعلامات باستخدام أدوات مثل `EXPLAIN ANALYZE` في PostgreSQL.
- تقسيم الاستعلامات المعقدة إلى استعلامات أبسط عند الضرورة.

### 3. مشكلات تتعلق بتحويل UUID بين Python وقاعدة البيانات

**المشكلة**:
أحيانًا يحدث تضارب في أنواع البيانات عند التعامل مع UUID بين FastAPI وSQLAlchemy وPostgreSQL.

**الحل**:
- ضمان استخدام `UUID(as_uuid=True)` في تعريفات الأعمدة.
- استخدام `uuid` من مكتبة Python القياسية لإنشاء وتحويل الـ UUID.
- التأكد من تعريف الحقول بشكل صحيح في مخططات Pydantic.

## الموارد المفيدة لحل المشكلات

- [وثائق FastAPI الرسمية](https://fastapi.tiangolo.com/)
- [دليل SQLAlchemy](https://docs.sqlalchemy.org/)
- [وثائق PostgreSQL](https://www.postgresql.org/docs/)
- [استراتيجيات حل مشكلات React](https://reactjs.org/docs/error-boundaries.html)
- [أدوات تصحيح أخطاء الشبكة (Network Debugging)](https://developer.mozilla.org/en-US/docs/Tools/Network_Monitor)

## معايير الإبلاغ عن الأخطاء

عند مواجهة خطأ جديد، يرجى توثيقه بالتنسيق التالي:

1. **وصف المشكلة**: وصف موجز وواضح للمشكلة
2. **خطوات إعادة الإنتاج**: الخطوات اللازمة لإعادة إنتاج المشكلة
3. **السلوك المتوقع**: ما الذي كان يجب أن يحدث
4. **السلوك الفعلي**: ما الذي حدث بالفعل
5. **رسائل الخطأ**: نسخة كاملة من رسائل الخطأ إن وجدت
6. **بيئة التشغيل**: معلومات عن البيئة (نظام التشغيل، الإصدارات، إلخ)
7. **الحل المقترح أو المطبق**: إذا تم حل المشكلة
