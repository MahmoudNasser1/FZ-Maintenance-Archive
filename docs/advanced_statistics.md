# توثيق إحصائيات الصيانة المتقدمة

تم تطوير نظام إحصائيات متقدم لتحليل بيانات حالات الصيانة وتوفير رؤى قيمة لإدارة Fix Zone. يُمكن هذا النظام المديرين والفنيين من تتبع مؤشرات الأداء الرئيسية وتحسين عمليات الصيانة.

## نقاط النهاية الإحصائية

### 1. توزيع الحالات حسب الحالة

```
GET /api/v1/cases/stats/status-distribution
```

هذه الواجهة توفر إحصائيات عن توزيع الحالات حسب حالتها (جديدة، قيد الإصلاح، تم الإصلاح، إلخ). تساعد المديرين على فهم توزيع الحالات ومراقبة تدفق العمل.

**مثال الاستجابة:**

```json
{
  "new": 25,
  "in_progress": 42,
  "waiting_for_parts": 12,
  "completed": 95,
  "cancelled": 8
}
```

### 2. بيانات السلاسل الزمنية

```
GET /api/v1/cases/stats/time-series
```

توفر هذه الواجهة بيانات السلاسل الزمنية لإنشاء الحالات وإكمالها، مما يساعد على تحليل الاتجاهات وتوقع الأنماط الموسمية.

**المعلمات الاختيارية:**
- `interval`: الفترة الزمنية للتجميع (daily, weekly, monthly)
- `start_date`: تاريخ البداية
- `end_date`: تاريخ النهاية

**مثال الاستجابة:**

```json
{
  "data": [
    {
      "date": "2025-01-01",
      "new_cases": 12,
      "completed_cases": 8
    },
    {
      "date": "2025-01-02",
      "new_cases": 9,
      "completed_cases": 11
    }
  ]
}
```

### 3. أداء الفنيين

```
GET /api/v1/cases/stats/technician-performance
```

تقدم هذه الواجهة تحليلاً لأداء الفنيين، بما في ذلك عدد الحالات المعالجة ومتوسط وقت الحل وتقييمات العملاء.

**المعلمات الاختيارية:**
- `technician_id`: معرف الفني (لتصفية النتائج لفني محدد)
- `period`: الفترة (week, month, quarter, year)

**مثال الاستجابة:**

```json
{
  "technicians": [
    {
      "id": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
      "name": "أحمد محمد",
      "cases_handled": 45,
      "avg_resolution_time_hours": 6.2,
      "customer_satisfaction": 4.7,
      "completion_rate": 0.92
    }
  ]
}
```

### 4. توزيع أنواع الأجهزة

```
GET /api/v1/cases/stats/device-distribution
```

توفر هذه الواجهة توزيع حالات الصيانة حسب نوع الجهاز، مما يساعد في فهم الأجهزة الأكثر شيوعًا في الصيانة.

**مثال الاستجابة:**

```json
{
  "smartphone": 120,
  "laptop": 85,
  "tablet": 42,
  "desktop": 15,
  "other": 10
}
```

### 5. إحصائيات وقت الحل

```
GET /api/v1/cases/stats/resolution-time
```

تقدم هذه الواجهة إحصائيات مفصلة عن وقت حل حالات الصيانة، بما في ذلك المتوسط والحد الأدنى والحد الأقصى والتوزيع.

**المعلمات الاختيارية:**
- `device_type`: نوع الجهاز (لتصفية النتائج)
- `period`: الفترة (week, month, quarter, year)

**مثال الاستجابة:**

```json
{
  "average_hours": 8.5,
  "min_hours": 0.5,
  "max_hours": 96.0,
  "median_hours": 6.0,
  "distribution": {
    "0-4 hours": 35,
    "4-8 hours": 42,
    "8-24 hours": 28,
    "24-48 hours": 15,
    "48+ hours": 7
  }
}
```

### 6. إحصائيات الإيرادات

```
GET /api/v1/cases/stats/revenue
```

توفر هذه الواجهة تحليلاً للإيرادات من حالات الصيانة، بما في ذلك الإجمالي ومتوسط الإيرادات لكل حالة وتوزيع الإيرادات حسب الحالة ونوع الجهاز.

**المعلمات الاختيارية:**
- `period`: الفترة (week, month, quarter, year)
- `device_type`: نوع الجهاز (لتصفية النتائج)

**مثال الاستجابة:**

```json
{
  "total_revenue": 15250.75,
  "average_revenue_per_case": 125.85,
  "revenue_by_status": {
    "completed": 12500.50,
    "in_progress": 2750.25
  },
  "revenue_by_device_type": {
    "smartphone": 7845.50,
    "laptop": 5320.25,
    "tablet": 2085.00
  }
}
```

### 7. تحليل رضا العملاء

```
GET /api/v1/cases/stats/customer-satisfaction
```

تقدم هذه الواجهة تحليلاً لتقييمات رضا العملاء وتعليقاتهم، مما يساعد على تحديد مجالات التحسين.

**المعلمات الاختيارية:**
- `period`: الفترة (week, month, quarter, year)
- `technician_id`: معرف الفني (لتصفية النتائج)

**مثال الاستجابة:**

```json
{
  "average_rating": 4.3,
  "rating_distribution": {
    "1": 5,
    "2": 8,
    "3": 15,
    "4": 42,
    "5": 85
  },
  "trend": [
    {
      "date": "2025-01",
      "average_rating": 4.1
    },
    {
      "date": "2025-02",
      "average_rating": 4.3
    },
    {
      "date": "2025-03",
      "average_rating": 4.5
    }
  ]
}
```

### 8. توزيع الحالات حسب الأولوية

```
GET /api/v1/cases/stats/cases-by-priority
```

توفر هذه الواجهة توزيع الحالات حسب مستوى الأولوية (منخفضة، متوسطة، عالية، عاجلة)، مما يساعد في إدارة الموارد وتخطيط العمل.

**مثال الاستجابة:**

```json
{
  "low": 35,
  "medium": 42,
  "high": 22,
  "urgent": 8
}
```

## استخدام الإحصائيات في واجهة المستخدم

يمكن استخدام هذه الإحصائيات في واجهة المستخدم لإنشاء:

1. **لوحة تحكم تحليلية**: عرض مؤشرات الأداء الرئيسية والاتجاهات
2. **تقارير أداء الفنيين**: مقارنة أداء الفنيين ومعدلات إنجازهم
3. **تقارير الإيرادات**: تتبع الإيرادات وتحليلها حسب الفترة ونوع الجهاز
4. **مؤشرات رضا العملاء**: مراقبة رضا العملاء وتحديد مجالات التحسين
5. **تخطيط الموارد**: استخدام توزيع الأولويات لتخصيص الموارد بشكل أفضل

## المكونات التقنية

تعتمد الإحصائيات على المكونات التالية:

1. **نماذج البيانات المحسنة**: تم تحديث نموذج Case لدعم الحقول الإضافية مثل:
   - `priority`: أولوية الحالة
   - `cost`: تكلفة الإصلاح
   - `customer_satisfaction`: تقييم رضا العميل
   - `device_type`: نوع الجهاز

2. **معالجة البيانات**: استخدام SQLAlchemy لاستعلامات قاعدة البيانات المعقدة
3. **Pydantic**: استخدام مخططات Pydantic لمعالجة وتنسيق البيانات الإحصائية
