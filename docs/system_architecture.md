# هندسة نظام أرشيف الصيانة

## نظرة عامة

يتبع نظام أرشيف الصيانة هندسة معمارية قائمة على الخدمات، مع واجهة أمامية (Frontend) مبنية بتقنية React وواجهة خلفية (Backend) مبنية بتقنية FastAPI. هذه الوثيقة تصف البنية المعمارية للنظام والمكونات الرئيسية وتفاعلاتها.

## رؤية معمارية عالية المستوى

```
+------------------+            +------------------+
|  واجهة المستخدم  |<---------->|   خدمة REST API  |
|  (React/TS/Tailwind) |        |   (FastAPI)     |
+------------------+            +------------------+
                                        |
                                        v
                                +------------------+
                                |  قاعدة البيانات  |
                                |  (PostgreSQL)   |
                                +------------------+
```

## المكونات الرئيسية

### 1. الواجهة الأمامية (Frontend)

الواجهة الأمامية مبنية باستخدام React و TypeScript، مع استخدام Tailwind CSS للتصميم. تم تنظيم المشروع باستخدام أفضل الممارسات والتقنيات الحديثة.

#### هيكل المجلدات

```
frontend/
├── public/            # الموارد العامة والرموز
├── src/
│   ├── assets/        # الموارد مثل الصور والأيقونات
│   ├── components/    # مكونات React القابلة لإعادة الاستخدام
│   │   ├── cases/     # مكونات متعلقة بالحالات
│   │   ├── dashboard/ # مكونات لوحة التحكم
│   │   ├── layout/    # مكونات التخطيط العام
│   │   └── reports/   # مكونات التقارير
│   ├── hooks/         # React hooks مخصصة
│   ├── pages/         # صفحات التطبيق
│   │   ├── cases/     # صفحات إدارة الحالات
│   │   └── reports/   # صفحات التقارير
│   ├── services/      # خدمات مثل طلبات API والمصادقة
│   ├── types/         # تعريفات TypeScript
│   ├── utils/         # دوال مساعدة وأدوات
│   ├── App.tsx        # مكون التطبيق الرئيسي
│   ├── index.tsx      # نقطة الدخول للتطبيق
│   └── routes.tsx     # تكوين مسارات التطبيق
└── package.json       # تبعيات وإعدادات المشروع
```

#### التقنيات المستخدمة

- **React**: مكتبة بناء واجهة المستخدم
- **TypeScript**: لغة برمجة قوية التنميط
- **React Router**: لإدارة المسارات والتنقل
- **Tailwind CSS**: إطار CSS لتصميم واجهة المستخدم
- **Heroicons**: مجموعة أيقونات متوافقة مع الواجهة
- **Axios**: مكتبة لإجراء طلبات HTTP

#### نمط إدارة الحالة

يستخدم النظام نمطًا تدريجيًا لإدارة الحالة:

1. **حالة المكون**: لمعظم حالات البيانات المحلية
2. **حالات شائعة**: باستخدام React Context API للحالات المشتركة بين عدة مكونات
3. **مدير الحالة المركزي**: يمكن إضافته مستقبلاً عند الحاجة (مثل Redux أو Recoil)

### 2. الواجهة الخلفية (Backend)

الواجهة الخلفية مبنية باستخدام FastAPI، وهو إطار عمل Python سريع وعالي الأداء لبناء واجهات برمجة التطبيقات (APIs).

#### هيكل المجلدات

```
backend/
├── app/
│   ├── api/           # تعريفات API
│   │   ├── deps.py    # التبعيات المشتركة (مثل الجلسات)
│   │   └── endpoints/ # النقاط النهائية لـ API
│   │       ├── cases.py
│   │       ├── notes.py
│   │       ├── attachments.py
│   │       └── reports.py
│   ├── core/          # التكوينات الأساسية
│   │   ├── config.py  # إعدادات التطبيق
│   │   ├── database.py # إعداد قاعدة البيانات
│   │   └── security.py # وظائف الأمان والمصادقة
│   ├── crud/          # عمليات قاعدة البيانات
│   │   ├── base.py    # الوظائف الأساسية
│   │   ├── case.py    # عمليات الحالات
│   │   └── ...
│   ├── db/            # إعدادات قاعدة البيانات
│   │   └── session.py
│   ├── models/        # نماذج SQLAlchemy
│   │   ├── base.py
│   │   ├── case.py
│   │   └── ...
│   ├── schemas/       # مخططات Pydantic
│   │   ├── case.py
│   │   └── ...
│   └── main.py        # نقطة الدخول للتطبيق
├── migrations/        # ملفات ترحيل قاعدة البيانات
│   ├── env.py
│   └── versions/
├── tests/             # اختبارات الوحدة
├── alembic.ini        # تكوين Alembic
└── requirements.txt   # تبعيات Python
```

#### التقنيات المستخدمة

- **FastAPI**: إطار عمل API سريع مع دعم الواجهات التفاعلية
- **SQLAlchemy**: ORM للتعامل مع قاعدة البيانات
- **Pydantic**: للتحقق من البيانات وتعريف المخططات
- **Alembic**: لترحيل قاعدة البيانات
- **PyJWT**: للتعامل مع رموز المصادقة
- **Python-multipart**: للتعامل مع الملفات المرفقة

### 3. قاعدة البيانات

النظام يستخدم PostgreSQL كنظام إدارة قاعدة البيانات العلائقية.

#### مخطط قاعدة البيانات

```
+----------------+       +---------------+       +----------------+
| Cases          |       | Notes         |       | Attachments    |
+----------------+       +---------------+       +----------------+
| id             |<---+  | id            |       | id             |
| title          |    |  | case_id       |       | case_id        |
| description    |    |  | content       |       | filename       |
| status         |    |  | created_at    |       | file_path      |
| device_type    |    |  | created_by    |       | content_type   |
| customer_id    |    |  +---------------+       | size           |
| technician_id  |    |                          | created_at     |
| created_at     |    |  +---------------+       | created_by     |
| updated_at     |    |  | Activities    |       +----------------+
+----------------+    |  +---------------+
                      +--| id            |
+----------------+    |  | case_id       |       +----------------+
| Users          |    |  | activity_type |       | WorkLogs       |
+----------------+    |  | description   |       +----------------+
| id             |<---+  | created_at    |       | id             |
| username       |    |  | created_by    |       | case_id        |
| email          |    |  +---------------+       | description    |
| hashed_password|    |                          | time_spent     |
| is_active      |    +------------------------->) start_time     |
| role           |                               | end_time       |
+----------------+                               | created_by     |
                                                 +----------------+
```

## الأمان والمصادقة

### استراتيجية المصادقة

يستخدم النظام استراتيجية مصادقة قائمة على JWT (JSON Web Tokens):

1. يرسل المستخدم بيانات الاعتماد (اسم المستخدم وكلمة المرور)
2. يتحقق الخادم من صحة بيانات الاعتماد ويولد رمز وصول ورمز تحديث
3. يتم تخزين الرموز في المتصفح (localStorage أو HTTP-only cookies)
4. يتم إرسال رمز الوصول مع كل طلب لاحق
5. يتم استخدام رمز التحديث للحصول على رمز وصول جديد عند انتهاء صلاحيته

### تشفير البيانات

- تشفير كلمات المرور باستخدام bcrypt
- تشفير الاتصال باستخدام HTTPS
- تشفير البيانات الحساسة في قاعدة البيانات

### التحكم في الوصول

يتم تنفيذ نظام تحكم بالوصول قائم على الأدوار (RBAC):

- **مشرف النظام**: وصول كامل إلى جميع الميزات
- **مدير**: وصول إلى الحالات والتقارير والمستخدمين
- **فني**: وصول إلى الحالات المخصصة وإضافة ملاحظات ومرفقات
- **مستخدم عادي**: وصول للقراءة فقط إلى الحالات المخصصة له

## استراتيجية التطوير

### نمط التطوير

يتبع المشروع نمط CI/CD (التكامل المستمر/النشر المستمر) مع الخطوات التالية:

1. تطوير الميزات في فروع منفصلة
2. اختبار الوحدات والتكامل
3. مراجعة الكود
4. دمج التغييرات في الفرع الرئيسي
5. النشر التلقائي

### اختبارات

يتم تنفيذ الاختبارات على عدة مستويات:

- **اختبارات الوحدة**: لاختبار المكونات والوظائف الفردية
- **اختبارات التكامل**: للتأكد من تكامل المكونات المختلفة
- **اختبارات الواجهة**: لاختبار تجربة المستخدم وسير العمل

## توسيع النظام مستقبلاً

### التكامل مع أنظمة خارجية

- تكامل مع نظام المخزون لتتبع قطع الغيار
- تكامل مع نظام الفواتير لإنشاء فواتير للعملاء
- واجهة برمجة تطبيقات (API) عامة للتكامل مع أنظمة خارجية

### تحسينات مستقبلية

- **تطبيق الهاتف المحمول**: لتمكين الفنيين من العمل أثناء التنقل
- **الذكاء الاصطناعي**: للتنبؤ بوقت إكمال الحالات وتحليل المشكلات الشائعة
- **وضع عدم الاتصال**: للعمل دون اتصال بالإنترنت مع مزامنة البيانات لاحقًا

## ملاحظات ختامية

تم تصميم هندسة النظام لتكون مرنة وقابلة للتوسع، مما يسمح بإضافة ميزات جديدة وتكامل مع أنظمة أخرى بسهولة. يجب على المطورين اتباع أفضل الممارسات والمعايير الموضحة في هذه الوثيقة عند تطوير ميزات جديدة أو تعديل القائمة منها.
